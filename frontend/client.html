<!DOCTYPE html> 
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø²Ø§Ø¨ÙˆÙ†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* =======================
   Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ø§Ù…Ø©
======================= */
body {
  font-family: Arial, sans-serif;
  background: #f5f6f8;
  margin: 0;
  padding: 20px;
}

/* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
h1, h2 {
  text-align: center;
  margin-bottom: 15px;
}

h1 {
  font-size: 1.6em;
  color: #007bff;
}

/* Ø±Ø³Ø§Ù„Ø© Ø«Ù‚Ø© */
.trust-msg {
  text-align:center;
  font-size:13px;
  color:#666;
  margin-bottom:5;
}

/* Ø±Ø³Ø§Ø¦Ù„ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© */
.legal-msg {
  background: #f0f0f0;
  border-left: 4px solid #007bff;
  padding: 10px 15px;
  margin-bottom: 15px;
  font-size: 13px;
  color: #333;
  line-height: 1.4em;
  border-radius: 5px;
}

/* Formulaire centrÃ© et responsive */
form {
  max-width: 500px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Labels et champs */
label {
  display: block;
  margin-top: 15px;
  font-weight: bold;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  font-size: 14px;
}

/* Champs readonly */
input[readonly] {
  background: #eee;
  color: #555;
}

/* Bouton */
button {
  width: 100%;
  margin-top: 25px;
  padding: 12px;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  background-color: #218838;
}

/* Adaptation Mobile */
@media (max-width: 600px) {
  body { padding: 10px; }
  form { padding: 15px; }
  h1 { font-size: 1.3em; }
  h2 { font-size: 1.2em; }
  input, select, button { font-size: 14px; padding: 8px; }
}
</style>
</head>
<body>

<!-- Ø´Ø¹Ø§Ø± Confirmi -->
<h1>ğŸ”’ "CONFIRMI"</h1>
<p class="trust-msg">Ø¹Ù…Ù„ÙŠØ© Ø¢Ù…Ù†Ø©  â€¢ Ø±Ø§Ø¨Ø· Ø®Ø§Øµ Ø¨Ùƒ â€¢ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„</p>

<!-- Ù†ØµÙˆØµ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© -->
<div class="legal-msg" style="text-align:center; display:inline-block; width:100%; max-width:100%; margin-top:15px; box-sizing:border-box; font-size:12px;">
â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø±ÙŠØ© ÙˆÙ„Ù† ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø«.<br>
â€¢ Ø¨Ø¥Ø§Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©.
</div>

<h2>  Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ùˆ Ø£ÙƒØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¨ÙƒÙ„ Ø£Ù…Ø§Ù†
 </h2>

<form id="clientForm" enctype="multipart/form-data">
  <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¨ÙˆÙ†
    <input type="text" id="clientName" readonly>
  </label>

  <label>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
    <input type="text" id="clientPhone" readonly>
  </label>

  <label>Ø±Ù…Ø² Ø§Ù„Ù…Ù†ØªØ¬
    <input type="text" id="productRef" readonly>
  </label>

  <label>Ø§Ù„Ù…Ø¨Ù„Øº
    <input type="number" id="amount" readonly>
  </label>

  <label>Ø§Ù„ÙˆØµÙ
    <input type="text" id="description" readonly>
  </label>

  <label>ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
    <select id="paymentMethod" required>
      <option value="especes">Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø³ØªÙ„Ø§Ù…</option>
      <option value="transfer">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
    </select>
  </label>

  <label id="attachmentLabel">Ù…Ø±ÙÙ‚ ÙˆØµÙ Ø§Ù„Ø¯ÙØ¹
    <input type="file" id="attachment">
  </label>

  <button type="submit">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
</form>

<script>
// --------------------
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
// --------------------
function getTransactionId() {
  const params = new URLSearchParams(window.location.search);
  return params.get("id");
}

// --------------------
// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
// --------------------
async function loadTransaction() {
  const id = getTransactionId();
  if (!id) { alert("Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù…ÙÙ‚ÙˆØ¯!"); return; }

  try {
    const res = await fetch(`/transaction/${id}`);
    const data = await res.json();
    if (!data.success) { alert("Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!"); return; }

    const t = data.transaction;
    document.getElementById("clientName").value = t.clientName;
    document.getElementById("clientPhone").value = t.clientPhone || "";
    document.getElementById("productRef").value = t.productRef;
    document.getElementById("amount").value = t.amount;
    document.getElementById("description").value = t.description || "";

    if(t.paymentMethod){
      const pm = document.getElementById("paymentMethod");
      pm.value = t.paymentMethod.toLowerCase();
      pm.disabled = true;
      document.getElementById("attachment").disabled = true;
    }

  } catch (err) {
    console.error(err);
    alert(" Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©!");
  }
}

loadTransaction();

// --------------------
// Ø¥Ø¯Ø§Ø±Ø© Ø­Ù‚Ù„ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
// --------------------
const paymentSelect = document.getElementById("paymentMethod");
const attachment = document.getElementById("attachment");
const attachmentLabel = document.getElementById("attachmentLabel");

function toggleAttachment() {
  if(paymentSelect.value.toLowerCase() === "especes") {
    attachment.required = false;
    attachment.value = "";
    attachment.disabled = true;
    attachmentLabel.style.display = "none";
  } else {
    attachment.required = true;
    attachment.disabled = false;
    attachmentLabel.style.display = "block";
  }
}

paymentSelect.addEventListener("change", toggleAttachment);
toggleAttachment();

// --------------------
// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯
// --------------------
document.getElementById("clientForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const id = getTransactionId();
  if(!id) { alert("Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù…ÙÙ‚ÙˆØ¯!"); return; }

  const payment = paymentSelect.value;
  const file = attachment.files[0];

  if(!payment){
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹.");
    return;
  }

  if(payment.toLowerCase() !== "especes" && !file){
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±ÙØ§Ù‚ ÙˆØµÙ Ø§Ù„Ø¯ÙØ¹.");
    return;
  }

  const formData = new FormData();
  formData.append("paymentMethod", payment);
  if(file) formData.append("attachment", file);

  try {
    const res = await fetch(`/confirm-transaction/${id}`, {
      method: "POST",
      body: formData
    });
    const data = await res.json();

    if(data.success){
      alert("ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ğŸ‘!");
      paymentSelect.disabled = true;
      attachment.disabled = true;
    } else {
      alert(" Ø®Ø·Ø£: " + data.message);
    }
  } catch(err){
    console.error(err);
    alert(" Ø®Ø·Ø£ ÙÙ‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯!");
  }
});
</script>
<footer style="
  margin-top:30px;
  font-size:12px;
  color:#777;
  text-align:center;">
 Ù…Ù†ØµØ© ØªÙ‚Ù†ÙŠØ© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙ‚Ø·"Confirmi"<br>
Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… ÙŠØªÙ…Ø§Ù† Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙˆØ§Ù„Ø²Ø¨ÙˆÙ†
</footer>

</body>
</html>












