<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cr√©ation de commande</title>
<style>
body { font-family: Arial; background: #f5f6f8; margin:0; padding:30px; }
h2 { text-align:center; margin-bottom:20px; }
form { max-width:500px; margin:auto; background:#fff; padding:25px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
label { display:block; margin-top:15px; font-weight:bold;}
input { width:100%; padding:10px; margin-top:6px; border-radius:6px; border:1px solid #ccc; font-size:14px;}
input[readonly]{background:#eee;}
button { width:100%; margin-top:20px; padding:12px; background:#007bff; color:#fff; border:none; border-radius:8px; font-size:16px; cursor:pointer;}
button:hover{background:#0056b3;}
#sendZone { max-width:500px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08); text-align:center; display:none;}
#sendZone button{margin-top:10px;}
</style>
</head>
<body>

<h2>Cr√©ation de commande</h2>

<form id="vendorForm">
  <label>Nom du client
    <input type="text" id="clientName" required>
  </label>

<label>T√©l√©phone du client
  <input type="tel" id="clientPhone" required>
</label>

  <label>R√©f√©rence produit
    <input type="text" id="productRef" required>
  </label>

  <label>Montant
    <input type="number" id="amount" required>
  </label>

  <label>Description
    <input type="text" id="description">
  </label>

  <button type="button" id="createBtn">Cr√©er la confirmation</button>
</form>


<div id="sendZone">
  <p><strong>‚úÖ Confirmation cr√©√©e</strong></p>

  <label>Lien √† envoyer au client
    <input type="text" id="clientLink" readonly>
  </label>

  <button type="button" onclick="copyLink()">üîó Copier le lien</button>
  <button type="button" onclick="sendWhatsApp()">üì≤ Ouvrir WhatsApp</button>
  <button type="button" onclick="sendSMS()">‚úâÔ∏è Ouvrir SMS</button>

  <p style="font-size:12px; opacity:0.7;">L‚Äôenvoi se fait depuis votre t√©l√©phone</p>
</div>

<script>
const createBtn = document.getElementById("createBtn");
const sendZone = document.getElementById("sendZone");
const clientLinkInput = document.getElementById("clientLink");

let confirmationLink = "";
let transactionCreated = false; // emp√™che doublons

createBtn.addEventListener("click", async () => {
  if(transactionCreated) { 
    alert("Transaction d√©j√† cr√©√©e !"); 
    return; 
  }

  const clientName = document.getElementById("clientName").value.trim();
  const clientPhone = document.getElementById("clientPhone").value.trim();
if (!/^\d{10}$/.test(clientPhone)) {
  alert("Num√©ro de t√©l√©phone invalide ! Il doit contenir exactement 10 chiffres.");
  return;
}
  const productRef = document.getElementById("productRef").value.trim();
  const amount = document.getElementById("amount").value.trim();
  const description = document.getElementById("description").value.trim();

  if(!clientName || !clientPhone ||!productRef || !amount){
    alert("Veuillez remplir les champs obligatoires !");
    return;
  }

  try {
    const res = await fetch("/create-confirmation", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ clientName, clientPhone, productRef, amount, description })
    });

    const data = await res.json();

    if(!data.success){
      alert("Erreur cr√©ation transaction !");
      return;
    }

    confirmationLink = data.clientLink;
    clientLinkInput.value = confirmationLink;
    sendZone.style.display = "block";
    transactionCreated = true;

  } catch(err){
    console.error(err);
    alert("Erreur serveur !");
  }
});

function sendWhatsApp(){
  const text = encodeURIComponent("Veuillez confirmer votre commande sur ce lien s√©curis√© : " + confirmationLink);
  window.open("https://wa.me/?text=" + text, "_blank");
}

function sendSMS(){
  const text = encodeURIComponent("Veuillez confirmer votre commande sur ce lien s√©curis√© : " + confirmationLink);
  window.location.href = "sms:?body=" + text;
}

function copyLink(){
  navigator.clipboard.writeText(confirmationLink);
  alert("Lien copi√© !");
}
</script>

</body>
</html>

