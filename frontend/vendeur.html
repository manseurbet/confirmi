<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Vendeur - Confirmi Intégré</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    /* Style du formulaire vendeur */
    .form-vendeur { border: 1px solid #aaa; padding: 15px; margin-bottom: 20px; border-radius: 6px; }
    /* Style des transactions Confirmi */
    .transaction { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 6px; }
    .message-confiance { color: green; font-style: italic; }
    button { margin: 3px 5px 3px 0; }
    small { display: block; color: #666; margin-top: 5px; }
  </style>
</head>
<body>

<h1>Vendeur - Gestion des commandes</h1>

<!-- FORMULAIRE VENDEUR EXISTANT -->
<div class="form-vendeur">
  <h2>Formulaire Vendeur</h2>
  <!-- Ici ton formulaire vendeur reste intact -->
  <form id="form-vendeur">
    <label>Nom du produit : <input type="text" name="produit"></label><br><br>
    <label>Quantité : <input type="number" name="quantite"></label><br><br>
    <label>Prix unitaire : <input type="number" name="prix"></label><br><br>
    <button type="submit">Ajouter commande</button>
  </form>
</div>

<!-- CONTENEUR CONFIRMI (séparé, sécurisé) -->
<div id="confirmi-container">
  <h2>Confirmi — Gestion des règlements</h2>
  <!-- Les transactions seront injectées ici via JS -->
</div>

<script>
  // =========================
  // Données fictives pour test Confirmi
  // Dans l’application réelle, récupérer depuis la base du vendeur
  // =========================
  const transactions = [
    {
      id: "CONF-2026-101",
      montant: 120000,
      reference: "CONF-2026-101",
      statut: "en_attente",
      preuve: null,
      date_creation: "2026-01-29T10:00:00",
      date_maj: null
    },
    {
      id: "CONF-2026-102",
      montant: 95000,
      reference: "CONF-2026-102",
      statut: "en_attente",
      preuve: null,
      date_creation: "2026-01-29T11:00:00",
      date_maj: null
    }
  ];

  // =========================
  // Labels clairs pour chaque statut
  // =========================
  const statutLabels = {
    en_attente: "En attente de règlement",
    reglement_initie: "Règlement initié",
    reglement_valide: "Règlement validé",
    reglement_refuse: "Règlement refusé"
  };

  // =========================
  // Fonction principale : affichage des transactions Confirmi
  // =========================
  function renderTransactions() {
    const container = document.getElementById("confirmi-container");
    container.innerHTML = "<h2>Confirmi — Gestion des règlements</h2>";

    transactions.forEach(t => {
      const div = document.createElement("div");
      div.className = "transaction";
      div.id = `transaction-${t.id}`;
      div.innerHTML = `
        <p><strong>Montant :</strong> ${t.montant} DA</p>
        <p><strong>Référence :</strong> ${t.reference}</p>
        <p id="statut-${t.id}"><strong>Statut :</strong> ${statutLabels[t.statut]}</p>
        <!-- Bouton pour déposer la preuve de virement -->
        <input type="file" id="preuve-${t.id}" />
        <button onclick="deposerPreuve('${t.id}')">Déposer preuve</button>
        <!-- Boutons du bénéficiaire pour valider ou refuser -->
        <button onclick="validerReglement('${t.id}', true)">Valider</button>
        <button onclick="validerReglement('${t.id}', false)">Refuser</button>
        <!-- Message rassurant côté utilisateur -->
        <p id="message-${t.id}" class="message-confiance"></p>
        <small>Confirmi ne vérifie pas l’authenticité bancaire. Le bénéficiaire valide la transaction.</small>
      `;
      container.appendChild(div);
    });
  }

  // =========================
  // Routine : Déposer une preuve de paiement
  // =========================
  function deposerPreuve(id) {
    const input = document.getElementById(`preuve-${id}`);
    if (!input.files.length) {
      alert("Veuillez sélectionner un fichier."); // Vérification simple
      return;
    }

    const preuve = input.files[0].name; // Ici on simule l'upload, à remplacer par backend réel

    // Mise à jour de la transaction
    const transaction = transactions.find(t => t.id === id);
    transaction.preuve = preuve;
    transaction.statut = "reglement_initie"; // Statut clé : règlement initié
    transaction.date_maj = new Date().toISOString();

    // Mise à jour de l'interface
    document.getElementById(`statut-${id}`).innerText = "Statut : " + statutLabels[transaction.statut];
    document.getElementById(`message-${id}`).innerText = "Document reçu. Traitement en cours.";
  }

  // =========================
  // Routine : Validation ou refus par le bénéficiaire
  // =========================
  function validerReglement(id, accepte = true) {
    const transaction = transactions.find(t => t.id === id);
    transaction.statut = accepte ? "reglement_valide" : "reglement_refuse";
    transaction.date_maj = new Date().toISOString();

    // Mise à jour de l'interface
    document.getElementById(`statut-${id}`).innerText = "Statut : " + statutLabels[transaction.statut];
    document.getElementById(`message-${id}`).innerText = accepte
      ? "Règlement validé par le bénéficiaire."
      : "Règlement refusé, veuillez fournir une nouvelle preuve.";
  }

  // =========================
  // Initialisation : affichage au chargement de la page
  // =========================
  renderTransactions();

</script>
</body>
</html>
